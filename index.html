<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MESS//IA — DÉCHIFFRAGE</title>

<style>
  :root { --g:#00ff41; --r:#ff2020; --bg:#000; --panel:#010801; }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:var(--bg); min-height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; font-family:'Courier New',monospace; overflow:hidden; cursor:crosshair; color:var(--g); }
  body::before { content:''; position:fixed; inset:0; background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,0.18) 2px,rgba(0,0,0,0.18) 4px); pointer-events:none; z-index:9998; }
  body::after  { content:''; position:fixed; inset:0; background:radial-gradient(ellipse at center,transparent 30%,rgba(0,0,0,0.9) 100%); pointer-events:none; z-index:9997; }
  #flicker { position:fixed; inset:0; pointer-events:none; z-index:9996; animation:flicker .1s steps(1) infinite; }
  @keyframes flicker { 0%,87%,90%,93%,100%{opacity:1;} 88%,91%{opacity:0;} }
  @keyframes blk     { 0%,100%{opacity:1;} 50%{opacity:.12;} }
  @keyframes ep      { 0%,100%{opacity:.4;} 50%{opacity:.9;} }
  @keyframes flt     { 0%,100%{transform:translateY(0) rotate(-.3deg);} 50%{transform:translateY(-10px) rotate(.3deg);} }
  @keyframes gm      { 0%{transform:translateX(-3px);} 33%{transform:translateX(3px);} 66%{transform:translateX(-1px);} 100%{transform:translateX(0);} }
  @keyframes stepIn  { from{opacity:0;transform:translateY(8px);} to{opacity:1;transform:translateY(0);} }
  @keyframes shake   { 0%,100%{transform:translateX(0);} 25%{transform:translateX(-4px);} 75%{transform:translateX(4px);} }

  /* PLAY SCREEN */
  #play-screen { position:fixed; inset:0; background:#000; z-index:500; display:flex; flex-direction:column; align-items:center; justify-content:center; transition:opacity .8s; }
  #skull-click-wrap { display:flex; flex-direction:column; align-items:center; gap:0; }
  #skull-btn:hover { filter:drop-shadow(0 0 20px rgba(0,255,65,0.4)) !important; }

  /* LAYOUT */
  .layout { position:relative; z-index:10; display:grid; grid-template-columns:220px 1fr; width:min(940px,98vw); height:min(620px,96vh); border:1px solid rgba(0,255,65,.1); }

  /* SKULL PANEL */
  .skull-panel { background:var(--panel); border-right:1px solid rgba(0,255,65,.08); display:flex; flex-direction:column; align-items:center; justify-content:center; padding:20px 14px; gap:12px; position:relative; overflow:hidden; }
  .skull-panel::before { content:''; position:absolute; inset:0; background:radial-gradient(ellipse at 50% 55%,rgba(0,255,65,.025),transparent 70%); pointer-events:none; }
  .skull-wrap { width:180px; height:216px; animation:flt 5s ease-in-out infinite; filter:drop-shadow(0 0 14px rgba(0,255,65,.1)); position:relative; z-index:5; transition:filter 1s; }
  .skull-wrap.red { filter:drop-shadow(0 0 20px rgba(255,32,32,.5)) drop-shadow(0 0 40px rgba(255,32,32,.2)); }
  .skull-wrap.glitch { animation:gm .08s steps(1) 5; filter:drop-shadow(-3px 0 rgba(255,0,0,.7)) drop-shadow(3px 0 rgba(0,200,255,.7)); }
  .ep { animation:ep 3.2s ease-in-out infinite; }
  .ep2{ animation:ep 3.2s ease-in-out infinite; animation-delay:.5s; }
  .eye-el { transition:fill 1.5s ease; }
  canvas#wc { width:180px; height:36px; position:relative; z-index:5; }
  .skull-status { font-size:8px; letter-spacing:3px; color:rgba(0,255,65,.25); text-align:center; animation:blk 2s ease-in-out infinite; position:relative; z-index:5; transition:color 1s; }
  .skull-status.red { color:rgba(255,32,32,.7); animation:blk .6s ease-in-out infinite; }

  /* RIGHT PANEL */
  .right-panel { background:var(--panel); display:flex; flex-direction:column; overflow:hidden; }
  .top-bar { border-bottom:1px solid rgba(0,255,65,.07); padding:10px 16px; display:flex; align-items:center; justify-content:space-between; font-size:8px; color:rgba(0,255,65,.2); letter-spacing:2px; flex-shrink:0; }
  .top-bar-title { font-family:'Courier New',monospace; font-size:17px; color:rgba(0,255,65,.4); letter-spacing:4px; }
  .enc-dot { display:inline-block; width:6px; height:6px; border-radius:50%; background:rgba(0,255,65,.4); box-shadow:0 0 4px rgba(0,255,65,.3); animation:blk .9s ease-in-out infinite; margin-right:6px; }

  /* STEPS */
  .steps { flex:1; overflow-y:auto; padding:16px; display:flex; flex-direction:column; gap:10px; }
  .steps::-webkit-scrollbar { width:2px; }
  .steps::-webkit-scrollbar-thumb { background:rgba(0,255,65,.15); }
  .step-block { display:none; flex-direction:column; gap:10px; }
  .step-block.active { display:flex; animation:stepIn .4s ease forwards; }
  .step-title { font-family:'Courier New',monospace; font-size:16px; color:rgba(0,255,65,.55); letter-spacing:4px; border-bottom:1px solid rgba(0,255,65,.08); padding-bottom:8px; }
  .step-desc { font-size:9px; color:rgba(0,255,65,.2); letter-spacing:1px; line-height:1.8; }
  .step-error { font-size:8px; color:rgba(255,32,32,.6); letter-spacing:2px; min-height:14px; }
  .mini-label { font-size:8px; letter-spacing:3px; color:rgba(0,255,65,.2); text-transform:uppercase; margin-bottom:4px; }

  /* STEP 1 — GRID */
  .cipher-grid { display:grid; grid-template-columns:repeat(8,1fr); gap:5px; }
  .cc { aspect-ratio:1; border:1px solid rgba(0,255,65,.1); display:flex; align-items:center; justify-content:center; font-family:'Courier New',monospace; font-size:15px; color:rgba(0,255,65,.3); cursor:pointer; transition:all .12s; background:rgba(0,255,65,.01); }
  .cc:hover  { border-color:rgba(0,255,65,.4); color:rgba(0,255,65,.8); background:rgba(0,255,65,.04); }
  .cc.ok     { border-color:var(--g); color:var(--g); background:rgba(0,255,65,.08); pointer-events:none; }
  .cc.bad    { border-color:var(--r); color:var(--r); animation:shake .3s ease; }
  .key-disp  { font-family:'Courier New',monospace; font-size:16px; color:rgba(0,255,65,.15); letter-spacing:8px; border:1px solid rgba(0,255,65,.06); padding:8px 12px; text-align:center; background:rgba(0,0,0,.3); }
  .key-disp .lit { color:rgba(0,255,65,.8); }

  /* STEP 2 — SEQUENCE */
  .seq-display { display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:center; border:1px solid rgba(0,255,65,.15); padding:12px 8px; background:rgba(0,0,0,.4); min-height:70px; }
  .si { width:44px; height:44px; border:2px solid rgba(0,255,65,.25); border-radius:2px; display:flex; align-items:center; justify-content:center; font-family:'Courier New',monospace; font-size:18px; color:rgba(0,255,65,.4); background:rgba(0,0,0,.5); transition:all .15s; }
  .si.lit { color:#fff; border-color:var(--g); box-shadow:0 0 12px rgba(0,255,65,.4); background:rgba(0,255,65,.1); }
  .si.ok  { color:var(--g); border-color:var(--g); background:rgba(0,255,65,.07); }
  .si.dim { color:rgba(0,255,65,.15); border-color:rgba(0,255,65,.08); }
  .seq-pad { display:grid; grid-template-columns:repeat(4,1fr); gap:7px; }
  .sb { padding:11px 0; border:1px solid rgba(0,255,65,.18); background:rgba(0,255,65,.02); color:rgba(0,255,65,.65); font-family:'Courier New',monospace; font-size:18px; cursor:pointer; transition:all .12s; }
  .sb:hover { border-color:rgba(0,255,65,.5); color:var(--g); background:rgba(0,255,65,.05); }
  .sb.flash { background:rgba(0,255,65,.15); border-color:var(--g); color:#fff; }
  .sb.bad   { background:rgba(255,32,32,.1); border-color:var(--r); color:var(--r); }

  /* STEP 3 — HUNT */
  .stream-area { font-size:10px; line-height:2; color:rgba(0,255,65,.25); letter-spacing:1px; border:1px solid rgba(0,255,65,.06); padding:10px 12px; background:rgba(0,0,0,.3); max-height:130px; overflow-y:auto; }
  .stream-area::-webkit-scrollbar { width:2px; }
  .stream-area::-webkit-scrollbar-thumb { background:rgba(0,255,65,.15); }
  .sw { cursor:pointer; padding:0 2px; border-radius:1px; transition:all .12s; }
  .sw:hover { color:rgba(0,255,65,.8); background:rgba(0,255,65,.05); }
  .sw.found { color:rgba(0,255,65,.15); text-decoration:line-through; pointer-events:none; }
  .hunt-info { font-size:9px; color:rgba(0,255,65,.2); letter-spacing:2px; border-left:2px solid rgba(0,255,65,.15); padding-left:10px; }

  /* STEP 4 — FINAL */
  .prog-label { font-size:8px; color:rgba(0,255,65,.18); letter-spacing:2px; display:flex; justify-content:space-between; }
  .prog-bg { height:3px; background:rgba(0,255,65,.05); border:1px solid rgba(0,255,65,.08); overflow:hidden; }
  .prog-fill { height:100%; background:linear-gradient(90deg,rgba(0,255,65,.3),var(--g)); width:0; box-shadow:0 0 6px rgba(0,255,65,.4); transition:width .15s; }
  .hex-scroll { font-size:8px; color:rgba(0,255,65,.15); letter-spacing:2px; line-height:1.8; }
  .decoded-out { font-family:'Courier New',monospace; font-size:17px; color:rgba(0,255,65,0); letter-spacing:1.5px; line-height:1.7; border:1px solid rgba(0,255,65,.06); padding:12px 14px; background:rgba(0,0,0,.3); min-height:80px; white-space:pre-wrap; transition:color .3s; }
  .decoded-out.on { color:rgba(0,255,65,.82); }
  .bcur2 { display:inline-block; width:9px; height:16px; background:rgba(0,255,65,.7); animation:blk .6s step-end infinite; vertical-align:middle; margin-left:1px; }

  /* READING OVERLAY */
  #reading-overlay { display:none; position:fixed; inset:0; z-index:400; background:rgba(0,0,0,.6); align-items:center; justify-content:center; }
  #reading-overlay.show { display:flex; }
  .reading-box { border:1px solid rgba(255,32,32,.3); background:#000; padding:20px 28px; text-align:center; font-size:9px; letter-spacing:3px; color:rgba(255,32,32,.5); animation:blk 1.5s ease-in-out infinite; }
  .reading-box b { display:block; font-family:'Courier New',monospace; font-size:16px; color:rgba(255,32,32,.7); letter-spacing:4px; margin-bottom:6px; }

  /* FACE ALERT */
  #face-alert {
    display:none; position:fixed; inset:0; z-index:600;
    background:rgba(0,0,0,.95);
    align-items:center; justify-content:center;
  }
  #face-alert.show { display:flex; }
  #face-inner {
    display:flex; flex-direction:row; gap:20px; align-items:flex-start;
    padding:20px; border:1px solid rgba(255,32,32,.2);
    background:rgba(8,0,0,.9); max-width:500px; width:90vw;
  }
  #face-left { flex:0 0 auto; display:flex; flex-direction:column; gap:6px; }
  .face-box {
    position:relative; width:120px; height:120px;
    overflow:hidden; border:1px solid rgba(255,32,32,.4); flex-shrink:0;
  }
  #face-photo {
    position:absolute; top:0; left:0;
    width:120px !important; height:120px !important;
    max-width:120px !important; max-height:120px !important;
    object-fit:cover; object-position:center top; display:block;
  }
  #face-scan-overlay { position:absolute; inset:0; pointer-events:none; z-index:2; }
  .face-scan {
    position:absolute; left:0; right:0; height:2px; z-index:3;
    background:linear-gradient(90deg,transparent,rgba(255,32,32,.9),transparent);
    animation:fscan 1.8s linear infinite;
  }
  @keyframes fscan { 0%{top:0%} 100%{top:100%} }
  .fc { position:absolute; width:14px; height:14px; border-color:var(--r); border-style:solid; z-index:4; }
  .fc.tl { top:0; left:0; border-width:2px 0 0 2px; }
  .fc.tr { top:0; right:0; border-width:2px 2px 0 0; }
  .fc.bl { bottom:0; left:0; border-width:0 0 2px 2px; }
  .fc.br { bottom:0; right:0; border-width:0 2px 2px 0; }
  #face-match-bar { width:120px; height:2px; background:rgba(255,32,32,.08); border:1px solid rgba(255,32,32,.15); overflow:hidden; }
  #face-match-fill { height:100%; width:0; background:linear-gradient(90deg,rgba(255,32,32,.3),var(--r)); }
  #face-match-label { font-size:7px; letter-spacing:2px; color:rgba(255,32,32,.3); }
  #face-match-pct { color:rgba(255,32,32,.7); }
  #face-right { flex:1; display:flex; flex-direction:column; gap:7px; min-width:0; }
  .face-title { font-size:13px; letter-spacing:4px; color:rgba(255,32,32,.9); animation:blk .5s ease-in-out infinite; }
  .face-sub { font-size:7px; letter-spacing:2px; color:rgba(255,32,32,.3); }
  .face-prog-bg { height:2px; background:rgba(255,32,32,.08); border:1px solid rgba(255,32,32,.1); overflow:hidden; }
  .face-prog-fill { height:100%; width:0; background:linear-gradient(90deg,rgba(255,32,32,.4),var(--r)); }
  .face-row { font-size:7px; letter-spacing:2px; color:rgba(255,32,32,.4); text-transform:uppercase; opacity:0; transition:opacity .4s; padding:3px 0; border-bottom:1px solid rgba(255,32,32,.06); }
  .face-row.show { opacity:1; }
  .face-row strong { color:rgba(255,80,80,.9); font-size:10px; letter-spacing:2px; }
  #face-protocol { font-size:7px; letter-spacing:2px; color:rgba(255,150,0,.5); text-transform:uppercase; opacity:0; transition:opacity .5s; }
  #face-protocol.show { opacity:1; }
  #face-warning { font-size:7px; letter-spacing:2px; color:rgba(255,32,32,.2); animation:blk 2s ease-in-out infinite; text-transform:uppercase; opacity:0; transition:opacity .5s; }
  #face-warning.show { opacity:1; }
  #face-close-btn {
    margin-top:8px; background:none; border:1px solid rgba(255,32,32,.2);
    color:rgba(255,32,32,.4); font-family:'Courier New',monospace;
    font-size:7px; letter-spacing:3px; padding:7px 12px; cursor:pointer;
    text-transform:uppercase; opacity:0; transition:all .2s;
  }
  #face-close-btn.show { opacity:1; }
  #face-close-btn:hover { border-color:rgba(255,32,32,.6); color:rgba(255,32,32,.8); background:rgba(255,32,32,.04); }
</style>
</head>
<body>
<div id="flicker"></div>

<!-- PLAY SCREEN -->
<div id="play-screen">
  <div id="skull-click-wrap">
    <svg id="skull-btn" viewBox="0 0 260 310" xmlns="http://www.w3.org/2000/svg" width="160" height="192" style="cursor:pointer;filter:drop-shadow(0 0 12px rgba(0,255,65,0.15));animation:flt 4s ease-in-out infinite;" onclick="doLaunch()">
      <defs>
        <radialGradient id="sg2" cx="50%" cy="40%" r="60%"><stop offset="0%" stop-color="#101410"/><stop offset="65%" stop-color="#060806"/><stop offset="100%" stop-color="#000"/></radialGradient>
        <radialGradient id="eg2" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#00ff41" stop-opacity="1"/><stop offset="100%" stop-color="#00ff41" stop-opacity="0"/></radialGradient>
        <filter id="gb2"><feGaussianBlur stdDeviation="6"/></filter>
      </defs>
      <ellipse cx="130" cy="112" rx="96" ry="102" fill="url(#sg2)" stroke="#0d110d" stroke-width="1"/>
      <ellipse cx="60" cy="152" rx="20" ry="13" fill="#050705"/>
      <ellipse cx="200" cy="152" rx="20" ry="13" fill="#050705"/>
      <path d="M114 150 Q120 142 125 150 L127 165 Q123 170 119 165Z" fill="#000"/>
      <path d="M146 150 Q140 142 135 150 L133 165 Q137 170 141 165Z" fill="#000"/>
      <ellipse cx="90" cy="114" rx="28" ry="24" fill="#000"/>
      <ellipse cx="170" cy="114" rx="28" ry="24" fill="#000"/>
      <ellipse cx="90" cy="114" rx="22" ry="18" fill="url(#eg2)" filter="url(#gb2)" style="animation:ep 3s ease-in-out infinite;"/>
      <ellipse cx="170" cy="114" rx="22" ry="18" fill="url(#eg2)" filter="url(#gb2)" style="animation:ep 3s ease-in-out infinite;animation-delay:.5s;"/>
      <ellipse cx="90" cy="114" rx="7" ry="7" fill="#00ff41" style="animation:ep 3s ease-in-out infinite;" opacity=".7"/>
      <ellipse cx="170" cy="114" rx="7" ry="7" fill="#00ff41" style="animation:ep 3s ease-in-out infinite;animation-delay:.5s;" opacity=".7"/>
      <path d="M34 106 Q38 130 42 154 Q50 168 62 172 Q54 152 52 130 Q46 108 34 106Z" fill="#070907"/>
      <path d="M226 106 Q222 130 218 154 Q210 168 198 172 Q206 152 208 130 Q214 108 226 106Z" fill="#070907"/>
      <path d="M56 182 Q60 198 74 207 Q96 216 130 218 Q164 216 186 207 Q200 198 204 182" fill="#070907"/>
      <rect x="84" y="208" width="13" height="16" rx="2" fill="#0b100b" stroke="#121812" stroke-width="1"/>
      <rect x="100" y="207" width="13" height="18" rx="2" fill="#0d120d" stroke="#121812" stroke-width="1"/>
      <rect x="116" y="207" width="13" height="18" rx="2" fill="#0d120d" stroke="#121812" stroke-width="1"/>
      <rect x="132" y="207" width="13" height="18" rx="2" fill="#0d120d" stroke="#121812" stroke-width="1"/>
      <rect x="148" y="207" width="13" height="18" rx="2" fill="#0d120d" stroke="#121812" stroke-width="1"/>
      <rect x="164" y="208" width="13" height="16" rx="2" fill="#0b100b" stroke="#121812" stroke-width="1"/>
      <path d="M74 207 Q56 220 54 240 Q56 260 74 268 Q98 278 130 280 Q162 278 186 268 Q204 260 206 240 Q204 220 186 207 Q164 216 130 218 Q96 216 74 207Z" fill="url(#sg2)"/>
      <rect x="86" y="213" width="12" height="13" rx="2" fill="#0b100b" stroke="#121812" stroke-width="1"/>
      <rect x="101" y="211" width="12" height="15" rx="2" fill="#0d120d" stroke="#121812" stroke-width="1"/>
      <rect x="116" y="211" width="12" height="15" rx="2" fill="#0d120d" stroke="#121812" stroke-width="1"/>
      <rect x="131" y="211" width="12" height="15" rx="2" fill="#0d120d" stroke="#121812" stroke-width="1"/>
      <rect x="146" y="211" width="12" height="15" rx="2" fill="#0d120d" stroke="#121812" stroke-width="1"/>
      <rect x="161" y="213" width="12" height="13" rx="2" fill="#0b100b" stroke="#121812" stroke-width="1"/>
    </svg>
    <div id="skull-hint" style="font-size:9px;letter-spacing:4px;color:rgba(0,255,65,0.2);margin-top:18px;animation:blk 2.5s ease-in-out infinite;">CLIQUEZ POUR ACCÉDER</div>
  </div>
</div>

<!-- READING OVERLAY -->
<div id="reading-overlay">
  <div class="reading-box"><b>LECTURE EN COURS</b>SYNTHÈSE VOCALE ACTIVE</div>
</div>

<!-- FACE ALERT -->
<div id="face-alert">
  <div id="face-inner">
    <div id="face-left">
      <div class="face-box">
        <div class="fc tl"></div><div class="fc tr"></div><div class="fc bl"></div><div class="fc br"></div>
        <div class="face-scan"></div>
        <img src="mia.png" id="face-photo" alt="MIA DALE"/>
        <div id="face-scan-overlay"></div>
      </div>
      <div id="face-match-bar">
        <div id="face-match-fill"></div>
      </div>
      <div id="face-match-label">CORRESPONDANCE : <span id="face-match-pct">0%</span></div>
    </div>
    <div id="face-right">
      <div class="face-title">⚠ SYSTÈME CRACKÉ</div>
      <div class="face-sub">CE SYSTÈME A ÉTÉ CRACKÉ PAR</div>
      <div class="face-prog-bg"><div class="face-prog-fill" id="fpf"></div></div>
      <div class="face-row" id="fr1">RECONNAISSANCE — <strong>MIA DALE / BNI</strong></div>
      <div class="face-row" id="fr2">DONNÉES TRANSMISES AU SIÈGE — <strong>✓</strong></div>
      <div class="face-row" id="fr3">STATUT — <strong style="color:rgba(255,80,80,.9);">DANS LA LIGNE DE MIRE</strong></div>
      <div class="face-row" id="fr4">RECHERCHE DE MIA — <strong style="animation:blk .6s steps(1) infinite;display:inline-block;">EN COURS...</strong></div>
      <div id="face-protocol">⚠ PROTOCOLE LAIS SUSPENDU JUSQU'À NOUVEL ORDRE</div>
      <div id="face-warning">ACCÈS RESTREINT — FERMETURE MANUELLE REQUISE</div>
      <button id="face-close-btn" onclick="closeFaceAlert()">✕ FERMER LE PROTOCOLE</button>
    </div>
  </div>
</div>

<!-- MAIN LAYOUT -->
<div class="layout">

  <!-- SKULL -->
  <div class="skull-panel">
    <div class="skull-wrap" id="sw">
      <svg viewBox="0 0 260 310" xmlns="http://www.w3.org/2000/svg" width="180" height="216">
        <defs>
          <radialGradient id="sg" cx="50%" cy="40%" r="60%"><stop offset="0%" stop-color="#101410"/><stop offset="65%" stop-color="#060806"/><stop offset="100%" stop-color="#000"/></radialGradient>
          <radialGradient id="eg" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#00ff41" stop-opacity="1"/><stop offset="100%" stop-color="#00ff41" stop-opacity="0"/></radialGradient>
          <radialGradient id="er" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="#ff2020" stop-opacity="1"/><stop offset="100%" stop-color="#ff2020" stop-opacity="0"/></radialGradient>
          <filter id="gb"><feGaussianBlur stdDeviation="6"/></filter>
        </defs>
        <ellipse cx="130" cy="112" rx="96" ry="102" fill="url(#sg)" stroke="#0d110d" stroke-width="1"/>
        <ellipse cx="60" cy="152" rx="20" ry="13" fill="#050705" stroke="#090c09" stroke-width="1"/>
        <ellipse cx="200" cy="152" rx="20" ry="13" fill="#050705" stroke="#090c09" stroke-width="1"/>
        <path d="M114 150 Q120 142 125 150 L127 165 Q123 170 119 165Z" fill="#000"/>
        <path d="M146 150 Q140 142 135 150 L133 165 Q137 170 141 165Z" fill="#000"/>
        <ellipse cx="90" cy="114" rx="28" ry="24" fill="#000" stroke="#090c09" stroke-width="1"/>
        <ellipse cx="170" cy="114" rx="28" ry="24" fill="#000" stroke="#090c09" stroke-width="1"/>
        <ellipse id="egl" cx="90" cy="114" rx="22" ry="18" fill="url(#eg)" filter="url(#gb)" class="ep eye-el" opacity=".8"/>
        <ellipse id="egr" cx="170" cy="114" rx="22" ry="18" fill="url(#eg)" filter="url(#gb)" class="ep2 eye-el" opacity=".8"/>
        <ellipse id="epl" cx="90" cy="114" rx="7" ry="7" fill="#00ff41" class="ep eye-el" opacity=".7"/>
        <ellipse id="epr" cx="170" cy="114" rx="7" ry="7" fill="#00ff41" class="ep2 eye-el" opacity=".7"/>
        <path d="M34 106 Q38 130 42 154 Q50 168 62 172 Q54 152 52 130 Q46 108 34 106Z" fill="#070907" stroke="#090c09" stroke-width="1"/>
        <path d="M226 106 Q222 130 218 154 Q210 168 198 172 Q206 152 208 130 Q214 108 226 106Z" fill="#070907" stroke="#090c09" stroke-width="1"/>
        <path d="M56 182 Q60 198 74 207 Q96 216 130 218 Q164 216 186 207 Q200 198 204 182" fill="#070907" stroke="#090c09" stroke-width="1"/>
        <rect x="84" y="208" width="13" height="16" rx="2" fill="#0b100b" stroke="#121812" stroke-width="1"/>
        <rect x="100" y="207" width="13" height="18" rx="2" fill="#0d120d" stroke="#121812" stroke-width="1"/>
        <rect x="116" y="207" width="13" height="18" rx="2" fill="#0d120d" stroke="#121812" stroke-width="1"/>
        <rect x="132" y="207" width="13" height="18" rx="2" fill="#0d120d" stroke="#121812" stroke-width="1"/>
        <rect x="148" y="207" width="13" height="18" rx="2" fill="#0d120d" stroke="#121812" stroke-width="1"/>
        <rect x="164" y="208" width="13" height="16" rx="2" fill="#0b100b" stroke="#121812" stroke-width="1"/>
        <g id="jaw">
          <path d="M74 207 Q56 220 54 240 Q56 260 74 268 Q98 278 130 280 Q162 278 186 268 Q204 260 206 240 Q204 220 186 207 Q164 216 130 218 Q96 216 74 207Z" fill="url(#sg)" stroke="#090c09" stroke-width="1"/>
          <rect x="86" y="213" width="12" height="13" rx="2" fill="#0b100b" stroke="#121812" stroke-width="1"/>
          <rect x="101" y="211" width="12" height="15" rx="2" fill="#0d120d" stroke="#121812" stroke-width="1"/>
          <rect x="116" y="211" width="12" height="15" rx="2" fill="#0d120d" stroke="#121812" stroke-width="1"/>
          <rect x="131" y="211" width="12" height="15" rx="2" fill="#0d120d" stroke="#121812" stroke-width="1"/>
          <rect x="146" y="211" width="12" height="15" rx="2" fill="#0d120d" stroke="#121812" stroke-width="1"/>
          <rect x="161" y="213" width="12" height="13" rx="2" fill="#0b100b" stroke="#121812" stroke-width="1"/>
        </g>
      </svg>
    </div>
    <canvas id="wc" width="180" height="36"></canvas>
    <div class="skull-status" id="ss">EN ATTENTE...</div>
  </div>

  <!-- RIGHT -->
  <div class="right-panel">
    <div class="top-bar">
      <div class="top-bar-title">MESS//IA — DÉCODEUR</div>
      <div><span class="enc-dot"></span><span id="clk">--:--:--</span></div>
    </div>

    <div class="steps" id="steps">

      <!-- S1: GRID -->
      <div class="step-block active" id="step1">
        <div class="step-title">EXTRACTION CLÉ</div>
        <div class="step-desc">Trouvez et cliquez les 6 lettres de <strong style="color:rgba(0,255,65,.5)">VORTEX</strong> dans la grille une par une, dans l'ordre. La lettre cherchée est indiquée dans la clé partielle.</div>
        <div class="mini-label">CLÉ PARTIELLE</div>
        <div class="key-disp" id="kd">_ &nbsp; _ &nbsp; _ &nbsp; _ &nbsp; _ &nbsp; _</div>
        <div class="mini-label">GRILLE</div>
        <div class="cipher-grid" id="cg"></div>
        <div class="step-error" id="e1"></div>
      </div>

      <!-- S2: SEQUENCE -->
      <div class="step-block" id="step2">
        <div class="step-title">SÉQUENCE D'ACCÈS</div>
        <div class="step-desc">Mémorisez la séquence qui s'affiche, puis reproduisez-la avec le pad.</div>
        <div class="mini-label" id="sl">SÉQUENCE :</div>
        <div class="seq-display" id="sd"></div>
        <div class="mini-label" style="margin-top:8px;">PAD D'ENTRÉE :</div>
        <div class="seq-pad" id="sp"></div>
        <div class="step-error" id="e2"></div>
      </div>

      <!-- S3: HUNT -->
      <div class="step-block" id="step3">
        <div class="step-title">CHASSE AUX FRAGMENTS</div>
        <div class="step-desc">Trouvez 4 mots cachés dans le flux, un par un.</div>
        <div class="hunt-info">FRAGMENT ACTIF : <span id="ht" style="color:rgba(0,255,65,.4);letter-spacing:3px;font-size:13px;font-family:'Courier New',monospace;">—</span> &nbsp; <span id="hp" style="color:rgba(0,255,65,.15);">0/4</span></div>
        <div class="stream-area" id="sa"></div>
        <div class="step-error" id="e3"></div>
      </div>

      <!-- S4: FINAL -->
      <div class="step-block" id="step4">
        <div class="step-title">DÉCHIFFRAGE FINAL</div>
        <div class="step-desc">Toutes les clés intégrées. Déchiffrage en cours.</div>
        <div class="prog-label"><span>FLUX</span><span id="pct">0%</span></div>
        <div class="prog-bg"><div class="prog-fill" id="pf"></div></div>
        <div class="hex-scroll" id="hx">4D455353 2F2F4941 20444543 4F444552 20454E20 434F5552 532E2E2E</div>
        <div class="decoded-out" id="do"></div>
      </div>

    </div>
  </div>
</div>

<script>
// ==================== CLOCK ====================
setInterval(()=>{
  const n=new Date(),p=x=>String(x).padStart(2,'0');
  document.getElementById('clk').textContent=p(n.getHours())+':'+p(n.getMinutes())+':'+p(n.getSeconds());
},1000);

// ==================== AUDIO ====================
let AC=null, running=false;
function getAC(){ if(!AC) AC=new(window.AudioContext||window.webkitAudioContext)(); return AC; }

function startDrone(){
  const a=getAC();
  [[24,.05],[48,.02],[72,.009]].forEach(([f,v],i)=>{
    const o=a.createOscillator(),g=a.createGain(),lp=a.createBiquadFilter();
    lp.type='lowpass'; lp.frequency.value=160; o.type='sawtooth'; o.frequency.value=f; g.gain.value=v;
    o.connect(lp); lp.connect(g); g.connect(a.destination);
    const lf=a.createOscillator(),lg=a.createGain();
    lf.frequency.value=.04+i*.025; lg.gain.value=10;
    lf.connect(lg); lg.connect(o.detune); lf.start(); o.start();
  });
}

function phoneme(){
  if(!running) return;
  const a=getAC(),s=a.createOscillator(),m=a.createGain();
  s.type='sawtooth'; s.frequency.value=65+Math.random()*50; m.connect(a.destination);
  [[250+Math.random()*550,7],[700+Math.random()*800,5],[2000+Math.random()*600,3]].forEach(([f,q])=>{
    const fi=a.createBiquadFilter(),gi=a.createGain();
    fi.type='bandpass'; fi.frequency.value=f; fi.Q.value=q; gi.gain.value=.1;
    s.connect(fi); fi.connect(gi); gi.connect(m);
  });
  const d=.03+Math.random()*.11,t=a.currentTime;
  m.gain.setValueAtTime(0,t); m.gain.linearRampToValueAtTime(.55,t+.008);
  m.gain.setValueAtTime(.55,t+d-.015); m.gain.linearRampToValueAtTime(0,t+d);
  s.start(t); s.stop(t+d+.02);
  setTimeout(phoneme, Math.random()<.14?300+Math.random()*500:35+Math.random()*90);
}

function beep(freq=1800, dur=.05, vol=.06){
  const a=getAC(),o=a.createOscillator(),g=a.createGain();
  o.type='square'; o.frequency.value=freq; g.gain.setValueAtTime(vol,a.currentTime);
  g.gain.exponentialRampToValueAtTime(.001,a.currentTime+dur);
  o.connect(g); g.connect(a.destination); o.start(); o.stop(a.currentTime+dur+.01);
}
function clickSound(){ beep(1800+Math.random()*300,.045,.05); }
function errorSound(){ beep(180,.3,.07); }
function successSound(){
  const a=getAC();
  [880,1100,1320].forEach((f,i)=>{
    const o=a.createOscillator(),g=a.createGain();
    o.type='sine'; o.frequency.value=f;
    const t=a.currentTime+i*.12;
    g.gain.setValueAtTime(0,t); g.gain.linearRampToValueAtTime(.07,t+.02);
    g.gain.exponentialRampToValueAtTime(.001,t+.25);
    o.connect(g); g.connect(a.destination); o.start(t); o.stop(t+.3);
  });
}

// ==================== JAW ====================
let mo=0,mt=0;
const JAW=document.getElementById('jaw');
const JP=[.8,.1,.6,0,.9,.2,.5,0,.7,.3,0,.85,.15,.6,0,.4,.7,.2,.9,0];
let ji=0;
function nextMouth(){
  if(!running){setTimeout(nextMouth,80);return;}
  mt=JP[ji%JP.length]; ji++;
  setTimeout(nextMouth, Math.random()<.14?300+Math.random()*500:45+Math.random()*100);
}
(function aJaw(){ mo+=(mt-mo)*.14; JAW.setAttribute('transform',`rotate(${mo*22},130,207)`); requestAnimationFrame(aJaw);})();

// ==================== WAVEFORM ====================
const wc=document.getElementById('wc'),wctx=wc.getContext('2d');
let wA=4;
(function dw(){
  wctx.clearRect(0,0,180,36); wctx.strokeStyle='rgba(0,255,65,.35)'; wctx.lineWidth=1; wctx.beginPath();
  for(let i=0;i<=60;i++){
    const x=(i/60)*180,y=18+Math.sin(i*.45+Date.now()*.005)*wA*(Math.random()*.5+.75);
    i===0?wctx.moveTo(x,y):wctx.lineTo(x,y);
  }
  wctx.stroke(); requestAnimationFrame(dw);
})();

// ==================== GLITCH ====================
function glitch(){
  const el=document.getElementById('sw'); el.classList.add('glitch');
  setTimeout(()=>el.classList.remove('glitch'),400);
  setTimeout(glitch,3000+Math.random()*7000);
}

// ==================== EYES RED ====================
function eyesRed(){
  document.getElementById('sw').classList.add('red');
  ['egl','egr'].forEach(id=>document.getElementById(id).setAttribute('fill','url(#er)'));
  ['epl','epr'].forEach(id=>document.getElementById(id).setAttribute('fill','#ff2020'));
  document.getElementById('ss').textContent='DÉCHIFFRÉ';
  document.getElementById('ss').classList.add('red');
  wA=12;
}

// ==================== ADVANCE STEP ====================
function advance(from, to){
  successSound();
  document.getElementById('step'+from).classList.remove('active');
  document.getElementById('step'+to).classList.add('active');
  if(to===2) initS2();
  if(to===3) initS3();
  if(to===4) initS4();
}

// ==================== STEP 1: GRID ====================
const WORD='VORTEX', DECOY='ABCDFGHIJKLMNPQRSUWYZ';
let s1sel=[], s1input='', s1positions=[];

function buildGrid(){
  const SIZE=48, cells=Array(SIZE).fill(null);
  s1positions=[]; s1sel=[]; s1input='';
  // Place each letter of WORD at a unique random position
  while(s1positions.length<6){
    const p=Math.floor(Math.random()*SIZE);
    if(!s1positions.includes(p)) s1positions.push(p);
  }
  s1positions.forEach((pos,i)=>cells[pos]=WORD[i]);
  for(let i=0;i<SIZE;i++) if(!cells[i]) cells[i]=DECOY[Math.floor(Math.random()*DECOY.length)];
  const g=document.getElementById('cg'); g.innerHTML='';
  cells.forEach((ch,pos)=>{
    const c=document.createElement('div'); c.className='cc'; c.textContent=ch;
    // Mark WORD letters with data attribute — still looks same visually
    const wordIdx=s1positions.indexOf(pos);
    if(wordIdx!==-1) c.dataset.widx=wordIdx;
    c.onclick=()=>gridClick(c,pos,ch); g.appendChild(c);
  });
  updateKey();
}

function updateKey(){
  const d=document.getElementById('kd'); d.innerHTML='';
  const need=s1input.length;
  for(let i=0;i<6;i++){
    if(s1input[i]){
      d.innerHTML+=`<span class="lit">${s1input[i]}</span>&nbsp;`;
    } else if(i===need){
      // Next letter to find — show it with a dim highlight hint
      d.innerHTML+=`<span style="color:rgba(0,255,65,.5);border-bottom:1px solid rgba(0,255,65,.4);padding-bottom:1px;">${WORD[i]}<span style="font-size:8px;opacity:.4;">?</span></span>&nbsp;`;
    } else {
      d.innerHTML+=`<span style="color:rgba(0,255,65,.1);">_</span>&nbsp;`;
    }
  }
}

function gridClick(cell,pos,ch){
  if(s1sel.includes(pos)) return;
  clickSound();
  const need=s1input.length; // which letter index we need next (0=V,1=O,...)
  if(need>=6) return;
  const wordIdx=parseInt(cell.dataset.widx??'-1');
  // Correct: this cell IS the next needed WORD letter
  if(wordIdx===need){
    cell.classList.add('ok'); s1input+=ch; s1sel.push(pos);
    updateKey(); document.getElementById('e1').textContent='';
    if(s1input.length===6) setTimeout(()=>advance(1,2),600);
  } else if(wordIdx!==-1 && wordIdx!==need){
    // It's a word letter but wrong order
    cell.classList.add('bad'); errorSound();
    document.getElementById('e1').textContent='✗ MAUVAIS ORDRE — CHERCHEZ : '+WORD[need];
    setTimeout(()=>{ cell.classList.remove('bad'); document.getElementById('e1').textContent=''; },900);
  } else {
    // Decoy letter
    cell.classList.add('bad'); errorSound();
    document.getElementById('e1').textContent='✗ MAUVAISE LETTRE — CHERCHEZ : '+WORD[need];
    s1input=''; s1sel=[];
    setTimeout(()=>{
      document.querySelectorAll('.cc.ok').forEach(c=>c.classList.remove('ok'));
      document.querySelectorAll('.cc.bad').forEach(c=>c.classList.remove('bad'));
      document.getElementById('e1').textContent='';
      updateKey();
    },900);
  }
}

// ==================== STEP 2: SEQUENCE ====================
const SYMS=['◈','◆','▲','●','■','◉','▼','◀','★','◇'];
let seq=[], pSeq=[], sPhase='', sErr=0;

function initS2(){
  seq=[]; for(let i=0;i<6;i++) seq.push(SYMS[Math.floor(Math.random()*SYMS.length)]);
  pSeq=[]; sPhase='watching'; sErr=0;

  // Build display slots
  const sd=document.getElementById('sd'); sd.innerHTML='';
  for(let i=0;i<6;i++){
    const d=document.createElement('div'); d.className='si'; d.id='si'+i; d.textContent='·';
    sd.appendChild(d);
  }

  // Build pad
  const padSet=new Set(seq);
  while(padSet.size<8) padSet.add(SYMS[Math.floor(Math.random()*SYMS.length)]);
  const padArr=[...padSet].sort(()=>Math.random()-.5);
  const sp=document.getElementById('sp'); sp.innerHTML='';
  padArr.forEach(sym=>{
    const b=document.createElement('button'); b.className='sb'; b.textContent=sym;
    b.onclick=()=>seqPress(sym,b); sp.appendChild(b);
  });

  document.getElementById('sl').textContent='SÉQUENCE — REGARDEZ :';
  document.getElementById('e2').textContent='';
  setTimeout(playSeq, 700);
}

function playSeq(){
  sPhase='watching';
  for(let i=0;i<6;i++){
    const el=document.getElementById('si'+i);
    el.textContent='·'; el.className='si';
  }
  seq.forEach((sym,i)=>{
    setTimeout(()=>{
      const el=document.getElementById('si'+i);
      el.textContent=sym; el.classList.add('lit');
      clickSound();
      setTimeout(()=>{ el.classList.remove('lit'); el.classList.add('dim'); el.textContent='□'; },450);
      if(i===seq.length-1){
        setTimeout(()=>{
          sPhase='playing'; pSeq=[];
          document.getElementById('sl').textContent='REPRODUISEZ :';
          document.getElementById('e2').textContent='';
        },650);
      }
    },i*600+200);
  });
}

function seqPress(sym,btn){
  if(sPhase!=='playing') return;
  clickSound(); btn.classList.add('flash'); setTimeout(()=>btn.classList.remove('flash'),200);
  const idx=pSeq.length; pSeq.push(sym);
  const el=document.getElementById('si'+idx);
  if(seq[idx]===sym){
    el.textContent=sym; el.className='si ok';
    if(pSeq.length===seq.length){ sPhase='done'; document.getElementById('sl').textContent='✓ VALIDÉ'; setTimeout(()=>advance(2,3),700); }
  } else {
    errorSound(); sErr++;
    btn.classList.add('bad'); setTimeout(()=>btn.classList.remove('bad'),300);
    document.getElementById('e2').textContent='✗ ERREUR '+sErr+'/3'+(sErr>=3?' — RÉINITIALISATION':' — RECOMMENCEZ');
    sPhase='wait';
    if(sErr>=3){ setTimeout(()=>{ sErr=0; initS2(); },1200); }
    else {
      setTimeout(()=>{
        pSeq=[];
        for(let i=0;i<6;i++){ const e=document.getElementById('si'+i); e.textContent='·'; e.className='si'; }
        document.getElementById('e2').textContent='';
        setTimeout(playSeq,400);
      },900);
    }
  }
}

// ==================== STEP 3: HUNT ====================
const TARGETS=['MOSSEBA','CERBERUS','SIGNAL','FRAGMENT'];
const NOISE=['4F','OVERRIDE','NULL','0x44','ENCRYPT','BUFFER','X9F','LOOP','STACK','FRAME',
  'DATA','PATCH','HEX','ROOT','CORE','BYTE','NODE','SYNC','CACHE','PORT','MASK','FLAG',
  'KILL','BOOT','PING','QUERY','HASH','TOKEN','ERROR','VOID','LINK','WRAP','DUMP','LOAD'];
let hIdx=0, hFound=0;

function initS3(){
  hIdx=0; hFound=0;
  document.getElementById('ht').textContent=TARGETS[0];
  document.getElementById('hp').textContent='0/4';
  buildStream();
}

function buildStream(){
  const sa=document.getElementById('sa'); sa.innerHTML='';
  const toks=[...NOISE,...TARGETS].sort(()=>Math.random()-.5);
  toks.forEach(tok=>{
    const sp=document.createElement('span'); sp.className='sw'; sp.textContent=tok+' ';
    sp.onclick=()=>huntClick(tok,sp); sa.appendChild(sp);
  });
}

function huntClick(tok,sp){
  if(sp.classList.contains('found')) return;
  if(tok===TARGETS[hIdx]){
    clickSound(); successSound(); sp.classList.add('found');
    hFound++; hIdx++;
    document.getElementById('hp').textContent=hFound+'/4';
    document.getElementById('e3').textContent='';
    if(hFound>=4){ setTimeout(()=>advance(3,4),600); return; }
    document.getElementById('ht').textContent=TARGETS[hIdx];
  } else if(TARGETS.includes(tok)){
    errorSound(); sp.style.color='rgba(255,32,32,.6)';
    document.getElementById('e3').textContent='✗ MAUVAIS ORDRE — CHERCHEZ : '+TARGETS[hIdx];
    setTimeout(()=>{ sp.style.color=''; document.getElementById('e3').textContent=''; },1000);
  } else {
    sp.style.color='rgba(255,32,32,.4)'; setTimeout(()=>sp.style.color='',400);
  }
}

// ==================== STEP 4: FINAL ====================
const FINAL="Mosseba et Cerberus une fois alliés ne peuvent que provoquer une fin du monde précipitée. Manger de l'intérieur ces deux entités nous permettra de s'en défaire car on ne peut pas faire face aux moyens colossaux qu'ils ont. Ils finiront par se tuer eux-mêmes. On a beau changer les destins de chacun, toutes les simulations mènent à ce combo explosif. Il faut agir.";
const HEX=['4D455353 2F2F4941','20434552 42455255','5320414C 4C49414E','4345204641 54414C45','2E2E2E20 44454300'];

function initS4(){
  wA=10; document.getElementById('ss').textContent='DÉCHIFFRAGE...';
  const out=document.getElementById('do'); out.textContent=''; out.classList.remove('on');
  const hx=document.getElementById('hx');
  const H='0123456789ABCDEF';
  let hrun=true;
  (function sh(){
    if(!hrun) return;
    hx.textContent=HEX.map(row=>row.split('').map(c=>Math.random()>.5?H[Math.floor(Math.random()*16)]:c).join('')).join(' ');
    setTimeout(sh,80);
  })();
  let p=0;
  const pi=setInterval(()=>{
    p+=Math.random()*3+.5; if(p>=100){p=100;clearInterval(pi);}
    document.getElementById('pf').style.width=p+'%';
    document.getElementById('pct').textContent=Math.round(p)+'%';
  },120);
  setTimeout(()=>{
    hrun=false; hx.textContent=''; eyesRed();
    out.classList.add('on');
    let i=0; const cur=document.createElement('span'); cur.className='bcur2'; out.appendChild(cur);
    (function tc(){
      if(i>=FINAL.length){ cur.remove(); setTimeout(()=>speakText(FINAL,triggerFaceRec),600); return; }
      const c=FINAL[i]; out.insertBefore(document.createTextNode(c),cur); i++;
      const d=c==='.'||c===','?120+Math.random()*80:c===' '?25+Math.random()*20:22+Math.random()*18;
      setTimeout(tc,d);
    })();
  },5500);
}

// ==================== VOICE ====================
function speakText(text,onEnd){
  const overlay=document.getElementById('reading-overlay');
  overlay.classList.add('show');
  if(!window.speechSynthesis){
    overlay.classList.remove('show');
    if(onEnd) setTimeout(onEnd,500);
    return;
  }
  window.speechSynthesis.cancel();
  const utt=new SpeechSynthesisUtterance(text);
  utt.lang='fr-FR';
  utt.rate=0.78;
  utt.pitch=0.0;
  utt.volume=1;
  const vs=window.speechSynthesis.getVoices();
  const v=vs.find(x=>x.lang==='fr-FR')||vs.find(x=>x.lang.startsWith('fr'))||null;
  if(v) utt.voice=v;
  const done=()=>{ overlay.classList.remove('show'); if(onEnd) setTimeout(onEnd,800); };
  utt.onend=done; utt.onerror=done;
  // Safety timeout
  setTimeout(()=>{ overlay.classList.remove('show'); if(onEnd) onEnd(); }, text.split(' ').length*1400+4000);
  window.speechSynthesis.speak(utt);
}

if(window.speechSynthesis){ window.speechSynthesis.getVoices(); window.speechSynthesis.onvoiceschanged=()=>window.speechSynthesis.getVoices(); }

// ==================== ALARM ====================
function alarmSound(){
  const a=getAC();
  // Two-tone alarm repeating
  let count=0;
  (function pulse(){
    if(count>12) return;
    const freq=count%2===0?880:660;
    const o=a.createOscillator(),g=a.createGain();
    o.type='square'; o.frequency.value=freq;
    g.gain.setValueAtTime(0,a.currentTime);
    g.gain.linearRampToValueAtTime(.12,a.currentTime+.02);
    g.gain.setValueAtTime(.12,a.currentTime+.15);
    g.gain.linearRampToValueAtTime(0,a.currentTime+.22);
    o.connect(g); g.connect(a.destination);
    o.start(a.currentTime); o.stop(a.currentTime+.25);
    count++;
    setTimeout(pulse,220);
  })();
  // Low rumble
  const buf=a.createBuffer(1,Math.floor(a.sampleRate*.4),a.sampleRate);
  const d=buf.getChannelData(0); for(let i=0;i<d.length;i++) d[i]=Math.random()*2-1;
  const src=a.createBufferSource(),lp=a.createBiquadFilter(),gg=a.createGain();
  lp.type='lowpass'; lp.frequency.value=120; gg.gain.value=.06;
  src.buffer=buf; src.connect(lp); lp.connect(gg); gg.connect(a.destination);
  src.start(); src.stop(a.currentTime+.5);
}

// ==================== SPEAK ALERT ====================
function speakAlert(){
  if(!window.speechSynthesis) return;
  window.speechSynthesis.cancel();
  const utt = new SpeechSynthesisUtterance('Alerte. Alerte. Alerte. Alerte.');
  utt.lang = 'fr-FR';
  utt.rate = 0.7;
  utt.pitch = 0.0;
  utt.volume = 1;
  const vs = window.speechSynthesis.getVoices();
  const v = vs.find(x=>x.lang==='fr-FR') || vs.find(x=>x.lang.startsWith('fr')) || null;
  if(v) utt.voice = v;
  window.speechSynthesis.speak(utt);
}

// ==================== FACE REC ====================
function triggerFaceRec(){
  const fa=document.getElementById('face-alert'); fa.classList.add('show');
  alarmSound();
  // Voice alert
  speakAlert();

  // Face match percentage animation
  let mp=0;
  const mfi=document.getElementById('face-match-fill');
  const mpt=document.getElementById('face-match-pct');
  const mpi=setInterval(()=>{
    mp+=Math.random()*3+1; if(mp>=97.4){mp=97.4;clearInterval(mpi);}
    mfi.style.width=mp+'%';
    mpt.textContent=mp.toFixed(1)+'%';
  },50);

  // Data transmission progress bar
  let p=0;
  const fpf=document.getElementById('fpf');
  const ppi=setInterval(()=>{ p+=Math.random()*4+1; if(p>=100){p=100;clearInterval(ppi);} fpf.style.width=p+'%'; },60);

  // Reveal rows
  setTimeout(()=>document.getElementById('fr1').classList.add('show'),1000);
  setTimeout(()=>document.getElementById('fr2').classList.add('show'),2000);
  setTimeout(()=>document.getElementById('fr3').classList.add('show'),3000);
  setTimeout(()=>document.getElementById('fr4').classList.add('show'),4000);
  setTimeout(()=>document.getElementById('face-protocol').classList.add('show'),5000);
  setTimeout(()=>{
    document.getElementById('face-warning').classList.add('show');
    document.getElementById('face-close-btn').classList.add('show');
    // Repeat alarm every 8s
    setInterval(alarmSound, 8000);
  },6000);
}

function closeFaceAlert(){
  const fa=document.getElementById('face-alert');
  fa.style.transition='opacity 1s';
  fa.style.opacity='0';
  setTimeout(()=>fa.style.display='none',1100);
}


// ==================== BOOT ====================
function doLaunch(){
  const ps=document.getElementById('play-screen');
  if(ps.style.display==='none') return;
  ps.style.opacity='0';
  setTimeout(()=>ps.style.display='none', 700);
  getAC(); startDrone(); running=true;
  phoneme(); nextMouth(); wA=5;
  setTimeout(glitch,2000);
  buildGrid();
  document.getElementById('ss').textContent='ANALYSE EN COURS...';
}
</script>
</body>
</html>
